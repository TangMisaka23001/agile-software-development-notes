# 第六部分 ETS案例研究

## 第二十八章 visitor模式

visitor模式的一个非常常见的应用是，遍历大量的数据结构并产生报表。这使得数据结构对象中不含有任何产生报表的代码。如果想增加报表，只需增加
新的访问者，而不需要更改数据结构中的代码。这意味着报表可以被放置在不同的组件中，并且仅被那些需要它们的客户单独使用。

一般来说，如果一个应用程序中存在有需要以多种不同方式进行解释的数据结构，就可以使用visitor模式。

在每个使用访问者的情况中，所使用的数据结构都独立于它的用途。可以创建新的访问者，可以更改现有的访问者，并且可以把所有的访问者重新部署到
安装地点而不会引起现有数据结构的重新编译和重新部署。这就是visitor模式的威力。

visitor模式系列给我们提供了许多无需更改一个层次结构中的类即可修改其行为的方法。因此，它们有助于我们保持OCP。此外，它们也提供了用来分离
不同种类的功能的机制，从而使类不会和很多其他的功能混杂在一起。它们也同样有助于我们保持CCP。也应该可以清楚地看出，visitor模式系列的结构
中也使用了SRP、LSP以及DIP。

visitor模式是有诱惑力的。在它们面前很容易会失去自制力。如果它们有用就去使用它们，但是请对它们的必要性保持健康的怀疑。通常，可以使用
visitor模式解决的问题往往也可以使用更简单的方法解决。

## 第二十九章 state模式

有限状态自动机是软件宝库中最有用的抽象之一。它们提供了一个简单、优雅的方法去揭示和定义复杂系统的行为。它们同样也提供了一个易于理解、易于
修改的有效实现策略。我在系统的各个层面，从控制高层逻辑的GUI到最低层的通讯协议，都会使用它们。它们几乎适用于任何地方。

